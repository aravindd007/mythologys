Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… , Ø­Ø¨ÙŠØª Ø§Ø´Ø§Ø±Ùƒ Ù…Ø¹ Ø­Ø¶Ø±Ø§ØªÙƒÙ… Ø§Ù„ Methodology Ø§Ù„Ø®Ø§ØµØ© Ø¨ Cache Poisoning Ù„Ø¹Ù„ ÙˆØ¹Ø³Ù‰ Ø­Ø¯ ÙŠØ³ØªÙÙŠØ¯ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠÙ‡ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù„ÙŠ Ø¨ØªÙ‚Ø¯Ù… Ø§ÙŠ Service Ø§Ø­ÙŠØ§Ù†Ø§ Ø¨ØªÙ„Ø¬Ø£ Ù„Cache ÙˆØ¯ÙŠ Ø¹Ø¨Ø§Ø±Ù‡ Ø¹Ù† Memory Ø§Ùˆ Ù…ÙƒØ§Ù† Ø¨Ø®Ø²Ù† ÙÙŠÙ‡ Ø§Ù„Ø¯Ø§ØªØ§ Ø§Ù„Ù„ÙŠ Ø¯Ø§ÙŠÙ…Ø§ Ø§Ù„ users ÙŠØ­ØªØ§Ø¬ÙˆØ§ access Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ùˆ Ø¨ØªØªÙƒØ±Ø± Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ± ÙˆØ¯Ø§ Ø¨ÙŠÙ‚Ù„Ù„ Ù…Ù† overload Ø¹Ù†Ø¯ Ø§Ù„ server ..... ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠÙ‡ ÙÙŠÙ‡ ÙƒØ§Ù… ØªØ¹Ø±ÙŠÙ :
Cache poisoning : means that the attacker puts malicious content in the cache to affect all users
ÙˆØ¯Ø§ ØªØ¹Ø±ÙŠÙ Ø§Ù„ Cache poisoning Ø¨Ø¨Ø³Ø§Ø·Ù‡
Cache Key : means caching data and associating it with a specific identifier or key
Ø§Ù„ Cache Key Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† identifier Ø§Ù„Ù„ÙŠ Ù…Ù† Ø®Ù„Ø§Ù„Ù‡ Ø§Ù‚Ø¯Ø± Ø§ÙˆØµÙ„ Ù„Ù„Ø¯Ø§ØªØ§ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ù‡ Ù…Ø«Ø§Ù„ ÙˆÙ„Ù†ÙØªØ±Ø¶ Ø§Ù„ Cache ÙŠØ­ØªÙˆÙŠ Ø¹Ù„ÙŠ Ø§Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ø§Ù„ Files Ù…Ø«Ù„ ØµÙˆØ± ÙˆÙ…Ù„ÙØ§Øª ÙˆØ§ØµÙˆØ§Øª .... ÙƒÙ„ ÙˆØ§Ø­Ø¯ Ù„Ù‡ Cache_Key Ù…Ù† Ø®Ù„Ø§Ù„Ù‡ Ø§Ø­ØµÙ„ Ø¹Ù„ÙŠ Resources
Ø§Ù„ Cache Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Proxy Ø§Ùˆ Content Delivery Network ....
Unkeyed Input : means the part of requests that a cache ignores
Ù…Ø«Ø§Ù„ ÙŠÙˆØ¶Ø­ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ†Ù‡Ù… ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠÙ‡ Ù„Ù†ØªÙØ±Ø¶ Ø§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ set of rules Ø¨Ù†Ø§Ø¡ Ø¹Ù„ÙŠÙ‡Ù… Ø§Ø³ØªØ·ÙŠØ¹ Ø¨Ù†Ø§Ø¡ Cache_Key :

    Include the method (GET, POST) of the request
    Include the full URL path
    Include the value of the "User-Agent" header

Ø§Ù„Ø±ÙŠÙƒÙˆØ³Øª :
GET /example-page?id=123 HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Ø§Ù„Ø±ÙŠØ³Ø¨ÙˆÙ†Ø³ :
HTTP/1.1 200 OK
Content-Type: text/html
Ù…Ø§Ù‡Ùˆ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨ Cache_Key ØŸ
Ø·Ø¨Ù‚Ø§ Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ Rules Ø§Ø¹Ù„Ø§Ù‡ :
Cache_Key : GET | https://example.com/example-page?id=123 | Mozilla/5.0 Chrome/90.0
Ø§Ù„Ø§Ù† Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ‚ÙˆÙ… Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø®Ø± ÙŠØ³ØªØ®Ø¯Ù… google Chrome Ø¨Ø¹Ù…Ù„ Ù†ÙØ³ Ø§Ù„Ø±ÙŠÙƒÙˆØ³Øª ÙŠØ±Ù‰ Ù†ÙØ³ Ø§Ù„Ø±Ø¯ :
HTTP/1.1 200 OK
Content-Type: text/html
ÙˆØ§Ù„Ø³Ø¨Ø¨ Ø§Ù† Ø§Ù„Ø±ÙŠÙƒÙˆØ³Øª Ø§ØµØ¨Ø­ Ù„Ù‡ Cache_Key ÙŠØ¹Ø±Ø¶ Ù†ÙØ³ Ø§Ù„Ø±ÙŠØ³Ø¨ÙˆÙ†Ø³ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Browser Ù…Ø®ØªÙ„Ù
Ø§Ù„Ø§Ù† Ù†Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Ø±ÙŠÙƒÙˆÙŠØ³Øª Ø§Ø®Ø± Ù…Ø¹ Ø§Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Headers
Ø§Ù„Ø±ÙŠÙƒÙˆÙŠØ³Øª Ù…Ø¹ Ø§Ø¶Ø§ÙØ© Accept-Language Header Ùˆ Ø§Ù„ Value Ø§Ù†Ø¬Ù„Ø´ :
GET /images/info/img?id=123 HTTP/1.1
Host: Example
User-Agent: Mozilla/.....
Accept-Language: en-US
Ø±ÙŠÙƒÙˆÙŠØ³Øª Ø«Ø§Ù†ÙŠ Ù…Ù† Ø´Ø®Øµ Ø§Ø®Ø± Ù…Ø¹ Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„Ù„ØºØ© ÙˆÙ‡ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© :
GET /images/info/img?id=123 HTTP/1.1
Host: Example.com
User-Agent: Mozilla/.....
Accept-Language: FR
Ø§Ø°Ø§ Ù†Ø±Ù‰ Ø§Ù† Ø§ÙˆÙ„ ÙˆØ«Ø§Ù†ÙŠ Request Ù„Ù‡Ù… Ù†ÙØ³ Cache_Key :
Cache_Key : GET | https://Example.com/images/info/img?id=123 | Mozilla/5.0
ÙˆÙ‡Ù†Ø§ Ù†Ø±Ù‰ Ø§Ù† Accept-Language Header Ù„Ù… ÙŠØ¯Ø®Ù„ ÙÙŠ ØªÙƒÙˆÙŠÙ† Cache_Key Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ Unkeyed Inputs Ù„Ø§Ù†Ù‡ Ø­Ø¯Ø« Ù„Ù‡ ignore Ù…Ù† Cache
How Test For Cache Poisoning :
ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù†Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Request Ø¹Ø§Ø¯ÙŠ Ø«Ù… Ù†Ù†ØªØ¸Ø± Ø§Ù„ Response ÙˆÙ‡Ù†Ø§Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„ Server Cache Headers Ø§Ù„Ø°ÙŠ ØªÙˆØ¶Ø­ Ù„Ù†Ø§ Ù‡Ù„ Ø§Ù„Ø±ÙŠÙƒÙˆØ³Øª Ø­Ø¯Ø« Ù„Ù‡ Served Ù…Ù† Cache Ø§Ù… Ù…Ù† Ø§Ù„ Server :
X-Cache -> take the values : hit or miss
Cache-Control -> take values : no-cache or public
Server-Timing
Ø¯ÙˆÙ„ Ø¨Ø¹Ø¶ Ø§Ù„ Cache Headers ÙÙŠ Response :
HTTP/1.1 200 OK
Content-Type: text/html
Server-Timing: cdn-cache; desc=HIT
ÙˆÙ‡Ù†Ø§ Ø§Ù„ Response Ø¨ÙŠØ¹Ø±ÙÙ†Ø§ Ø§Ù† Ø­ØµÙ„ Served Ù„Ù„Ø±ÙŠÙƒÙˆÙŠØ³Øª Ù…Ù† Cache ÙˆÙ„ÙŠØ³ Ø§Ù„ Server ÙˆÙ…Ù† Ø¹Ù†Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ù‚Ø¸Ø© Ù†Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ "poisoning"
Ø§Ù„Ø±ÙŠÙƒÙˆÙŠØ³Øª Ù…Ø¹ Ø§Ø¶Ø§ÙØ© Header Ù„Ø§ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„ server Ø§Ùˆ Cache Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡ :
GET /images/info/img?id=123 HTTP/1.1
\:
Host: Example.com
User-Agent: Mozilla/....
Ù‚Ù…Ù†Ø§ Ø¨Ø§Ø¶Ø§ÙØ© ğŸ˜• ÙƒØ§ header Ùˆ Ø­Ø¯Ø« Cache Ù„Ù„Ø±ÙŠØ³Ø¨ÙˆÙ†Ø³ ÙˆØ§Ø° Ù‚Ù…Ù†Ø§ Ø¨Ø¹Ù…Ù„ Ø±ÙŠÙƒÙˆÙŠØ³Øª Ù…Ø±Ø© Ø§Ø®Ø±Ù‰ ÙÙŠ Ø§ÙŠ Ù…ØªØµÙØ­ Ø«Ù… ØªØ¸Ù‡Ø± Ù„Ù†Ø§ : Bad Message 400 ÙˆØ­Ø¯Ø« Reflected Ù„Ù„Header ÙˆÙ‡Ø°Ø§ ÙŠØ¯Ù„ Ø¹Ù„ÙŠ Ø§Ù† Cache Ù„Ù… ÙŠØ³ØªØ·ÙŠØ¹ Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨
Headers That Can Be Used To Cache :
X-Forwarded-Host: hackers-site.com
X-Host: hackers-site.com
Forwarded-Server: hackers-site.com
For Xss we can replace \: with X-Forwarded-Host
GET /images/info/img?id=123 HTTP/1.1
Host: Example.com
User-Agent: Mozilla/....
X-Forwarded-Host: <script>alert(1)</script>
Finally, I recommend you to use param-miner extension That help you identify hidden, unlinked parameters : https://github.com/PortSwigger/param-miner
and If you want to learn more , I recommend that you take a look :
https://book.hacktricks.xyz/pentesting-web/cache-deception
I've learned a lot from there ,Thanks all 
